language: node_js
sudo: false
matrix:
  include:
    - name: "Linux - Node 10"
      os: linux
      node_js: "10"
      env:
        - CXX=g++-4.9
        - CC=gcc-4.9
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          packages:
          - gcc-4.9
          - g++-4.9
    - name: "Linux - Node 12"
      os: linux
      node_js: "12"
      env:
        - CXX=g++-4.9
        - CC=gcc-4.9
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          packages:
          - gcc-4.9
          - g++-4.9
    - name: "Linux - Node 14"
      os: linux
      node_js: "14"
      env:
        - CXX=g++-4.9
        - CC=gcc-4.9
      addons:
        apt:
          sources:
          - ubuntu-toolchain-r-test
          packages:
          - gcc-4.9
          - g++-4.9
    - name: "OS X - Node 10"
      os: osx
      node_js: "10"
      osx_image: xcode11
      compiler: clang
      env:
        - CXX=g++
        - CC=gcc
    - name: "OS X - Node 12"
      os: osx
      node_js: "12"
      osx_image: xcode11
      compiler: clang
      env:
        - CXX=g++
        - CC=gcc
    - name: "OS X - Node 14"
      os: osx
      node_js: "14"
      osx_image: xcode11
      compiler: clang
      env:
        - CXX=g++
        - CC=gcc
before_script:
- npm run build-debug
before_deploy:
- npm run build-release
- $(npm bin)/prebuild -r node -t 10.20.0 -t 12.0.0 -t 14.0.0 --include-regex 'better_sqlite3.node$'
- $(npm bin)/prebuild -r electron -t 4.0.0 -t 5.0.0 -t 6.0.0 -t 7.0.0 -t 8.0.0 -t 9.0.0 -t 10.0.0 -t 11.0.0 --include-regex 'better_sqlite3.node$'
deploy:
  provider: releases
  api_key:
    secure: keChSsizNoaRy6+jaaxZx3v6FfqAKricrpMQUONX0EKsRCXu8JBEuWTy6N1jpDPcXAdaLURmf+K5Klk9cFfi91P2Jb2QZrIg6SUYkxgvldaaGEg2+thpsNlPPKDVx4LvBsCRmUb2043FIICYRdtyj+27Yf96iqateb7FKJ2u5EBsP6Bv4hxXaFkmnkW1dPi1cIFfd/CjXleRTAIlUxIGhKZi4ysrbaBmuBofQ5o3GlEqwlhjxd4DPI5rI5djJ1OEhease4qegI4LSXJOkILZHDc40gMzypDFz+6q+0uAKsYVpd68Fjt2CxZJxvdLKTLkQSd0gsm6/QJZautC3PO8ZbbcBpHjh/7CD1tQA+Wx/AoySaTZRG+N4V/J+wq5TCd52CsqtLeWIWxBpVIBfjvXFj+nTYRar0r5blCdTqRd5FrcRr6A7uTnM/Ieg5wTgvq939S1SHggXdrCGajnN+qz4QxxPDVZtGuVLayFwY8mycP9Q018ZiZieN3j9V43+ROj6zIrr8pH+HYR1Xj8KlZhhjq1gMugi0ebvjZFfl5vScRyNU5ArqPAAx+px3YaEvMO4b46Z67PN1J7GuZdFuD5xWSs1DLAW1cuCP1oke/J3A2rnNKiweX4gmC+fQVqrXsQLDcefDjp6+Jzsr9bOnAeT44qRxBdrPd0sZ8n1iq8LQQ=
  file: prebuilds/*
  file_glob: true
  skip_cleanup: true
  on:
    repo: vadimdemedes/better-sqlite3
    tags: true
    node_js: "14"